create database QLSV
use QLSV
go 
CREATE TABLE LOPHOC
(
MALOP CHAR(10) NOT NULL ,
TENLOP NVARCHAR(50) NULL , 
MANGANH CHAR(10) NOT NULL ,
TENNGANH NVARCHAR(50) NULL , 
PRIMARY KEY ( MALOP)
)
CREATE TABLE NGHENGHIEP(
 MANGHENGHIEP CHAR(10) NOT NULL ,
 TENNGHENGHIEP NVARCHAR(100) NULL , 
 PRIMARY KEY (MANGHENGHIEP)
)
CREATE TABLE MONHOC (
TENMONHOC NVARCHAR(100) NULL ,
MAMONHOC CHAR (5 ) NOT NULL,
PRIMARY KEY ( MAMONHOC)
)
create table SINHVIEN (
MASV INT NOT  NULL , 
TENSV NVARCHAR(100)  NULL ,
GIOITINH BIT NOT NULL, 
NGAYSINH DATETIME NULL ,
DIACHI NVARCHAR(100) NULL,
MANGHENGHIEP CHAR(10) NULL , 
MALOP CHAR(10) NULL,
PRIMARY KEY (MASV),
FOREIGN KEY (MALOP) REFERENCES LOPHOC(MALOP),
FOREIGN KEY (MANGHENGHIEP) REFERENCES NGHENGHIEP(MANGHENGHIEP)
)

CREATE TABLE DIEMTHI (
MASV INT NULL , 
MALOP CHAR(10) NULL,
MAMONHOC CHAR(5)  NULL ,
DIEM INT NULL,
FOREIGN KEY ( MASV) REFERENCES SINHVIEN(MASV) ,
FOREIGN KEY (MALOP) REFERENCES LOPHOC(MALOP),
FOREIGN KEY (MAMONHOC) REFERENCES MONHOC(MAMONHOC)
)
INSERT INTO NGHENGHIEP
VALUES 
('HS',N'HỌC SINH'),
('HR',N'QUẢN LÝ NHÂN SỰ')
INSERT INTO SINHVIEN
VALUES 
('1',N'NGUYỄN VĂN THẮNG','1','07/18/2002',N'HÀ TÂY','HS','CNTT05'),
('2',N'NGUYỄN THỊ B ','0','09/18/2003',N'HÀ NAM' ,'HR','KHMT06'),
('3',N'NGUYỄN HNIE ','0','11/19/2003',N'HÀ NỘI' ,'HR','CNTT05')
INSERT INTO MONHOC
VALUES 
(N'LẬP TRÌNH CƠ BẢN ','M1'),
(N'LẬP TRÌNH WEB ','M2'),
(N'CẤU TRÚC DỮ LIỆU VÀ GIẢI THUẬT','M3'),
(N'LẬP TRÌNH JAVA','M4')
INSERT INTO LOPHOC
VALUES 
('CNTT05' , N'CÔNG NGHỆ THÔNG TIN 05','CNTT',N'CÔNG NGHỆ THÔNG TIN'),
('KHMT06',N'KHOA HỌC MÁY TÍNH 01','KHMT',N'KHOA HỌC MÁY TÍNH')
INSERT INTO DIEMTHI 
VALUES 
('1','CNTT05','M1','10'),
('1','CNTT05','M2','10'),
('1','CNTT05','M3','10'),
('1','CNTT05','M4','10'),
('2','KHMT06','M2','9'),
('2','KHMT06','M1','9'),
('3','KHMT06','M4','10'),
('3','KHMT06','M3','10')
INSERT INTO DIEMTHI 
VALUES 
('1','CNTT05','M4','5'),
('1','CNTT05','M2','6'),
('2','KHMT06','M3','7'),
('3','KHMT06','M4','4')
--SELECT
SELECT * FROM LOPHOC
SELECT * FROM SINHVIEN 
SELECT * FROM NGHENGHIEP
SELECT * FROM DIEMTHI
SELECT * FROM MONHOC
SELECT * FROM DIEMTHI WHERE DIEM ='10'
--JOIN
select TENNGANH,TENSV from LOPHOC A LEFT JOIN SINHVIEN B ON A.MALOP = B.MALOP LEFT JOIN DIEMTHI C ON B.MASV=C.MASV
-- GROUPBY AND HAVING 
SELECT DIEM ,COUNT( MASV)
FROM DIEMTHI
GROUP BY DIEM
HAVING DIEM > 4;
-- UNION 
SELECT MANGHENGHIEP FROM SINHVIEN
UNION 
SELECT MANGHENGHIEP FROM NGHENGHIEP;
-- VIEW 
CREATE VIEW DIEM10 AS
SELECT MASV 
FROM DIEMTHI
SELECT * FROM DIEM10

DROP VIEW DIEM10  

--STORED 
CREATE PROCEDURE SelectAllSV
AS
SELECT * FROM SINHVIEN
GO;
EXEC SelectAllSV;

-- TRANSACTION
USE QLSV
BEGIN TRANSACTION 
	SELECT *  FROM DIEMTHI WHERE DIEM = '10' 
	DELETE  DIEMTHI WHERE DIEM = '10' 
	SELECT *  FROM DIEMTHI WHERE DIEM = '10' 
ROLLBACK ; 
SELECT *  FROM DIEMTHI WHERE DIEM = '10'  
